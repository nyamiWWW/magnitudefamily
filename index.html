<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Space Community Map</title>
    <style>
        body { background: #05070a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; }
        .container { max-width: 900px; margin: 50px auto; padding: 20px; border: 1px solid #1f2937; border-radius: 15px; background: #0d1117; }
        #map-display { width: 100%; border-radius: 10px; border: 2px solid #30363d; margin-bottom: 20px; }
        .controls { background: #161b22; padding: 20px; border-radius: 10px; }
        .btn { background: #238636; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; text-decoration: none; display: inline-block; }
        .btn:hover { background: #2ea043; }
        .btn-download { background: #21262d; border: 1px solid #f0f6fc1a; margin-top: 10px; }
        input[type="file"] { margin: 15px 0; }
        #status { margin-top: 15px; color: #8b949e; }
    </style>
</head>
<body>

<div class="container">
    <h1>–ö–æ—Å–º—ñ—á–Ω–∞ –°–ø—ñ–ª—å–Ω–æ—Ç–∞</h1>
    <p>–ó–∞–≤–∞–Ω—Ç–∞–∂ —Å–≤–æ—î —Ñ–æ—Ç–æ, —â–æ–± —Å—Ç–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω–æ—é –Ω–∞—à–æ–≥–æ –≤—Å–µ—Å–≤—ñ—Ç—É.</p>
    
    <img id="map-display" src="main_map.png" alt="–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏...">
    
    <div class="controls">
        <input type="file" id="avatarInput" accept="image/*">
        <br>
        <button class="btn" onclick="uploadAvatar()">üöÄ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ –∫–æ—Å–º–æ—Å</button>
        <br>
        <a href="main_map.png" download="our_space.png" class="btn btn-download">‚¨áÔ∏è –°–∫–∞—á–∞—Ç–∏ –≤—Å—é –∫–∞—Ä—Ç—É</a>
    </div>
    
    <div id="status"></div>
</div>

<script>
    async function uploadAvatar() {
        const fileInput = document.getElementById('avatarInput');
        const status = document.getElementById('status');
        
        if (!fileInput.files[0]) {
            alert("–°–ø–æ—á–∞—Ç–∫—É –≤–∏–±–µ—Ä–∏ —Ñ–æ—Ç–æ!");
            return;
        }

        status.innerText = "üåü –ì–æ—Ç—É—î–º–æ –∑–∞–ø—É—Å–∫...";
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = async function() {
            const base64Content = reader.result.split(',')[1];
            const fileName = `user_${Math.floor(Math.random() * 1000000)}.png`;

            // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¢–£–¢ ---
            const GITHUB_TOKEN = "–í–ê–®_–¢–û–ö–ï–ù_–¢–£–¢"; // <--- –í–°–¢–ê–í–¢–ï –í–ê–® –¢–û–ö–ï–ù –°–Æ–î–ò
            const REPO_PATH = "–í–ê–®_–õ–û–ì–Ü–ù/–ù–ê–ó–í–ê_–†–ï–ü–û–ó–ò–¢–û–†–Ü–Æ"; // <--- –í–°–¢–ê–í–¢–ï –í–ê–® –®–õ–Ø–• (–Ω–∞–ø—Ä. artem/space-site)
            // ------------------------

            const url = `https://api.github.com/repos/${REPO_PATH}/contents/avatars/${fileName}`;

            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: "New astronaut joined",
                        content: base64Content
                    })
                });

                if (response.ok) {
                    status.innerHTML = "‚úÖ –£—Å–ø—ñ—Ö! –ö–∞—Ä—Ç–∞ –æ–Ω–æ–≤–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 1-2 —Ö–≤–∏–ª–∏–Ω–∏. <br> –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—ñ–∑–Ω—ñ—à–µ.";
                    fileInput.value = "";
                } else {
                    const error = await response.json();
                    status.innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞: " + error.message;
                }
            } catch (e) {
                status.innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ –∫–æ—Å–º–æ—Å–æ–º.";
            }
        };
        
        reader.readAsDataURL(file);
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫
    setInterval(() => {
        const img = document.getElementById('map-display');
        img.src = "main_map.png?t=" + new Date().getTime();
    }, 30000);
</script>

</body>
</html>
